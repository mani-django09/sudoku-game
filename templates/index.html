<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sudoku Game</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="game-container">
        <header class="game-header">
            <div class="header-left">
                <h1>Sudoku</h1>
                <div class="difficulty-selector">
                    <button class="mode-btn active" id="new-game" data-difficulty="easy">Easy</button>
                    <button class="mode-btn" data-difficulty="medium">Medium</button>
                    <button class="mode-btn" data-difficulty="hard">Hard</button>
                </div>
            </div>
            <div class="header-right">
                <button id="pause" class="icon-btn">
                    <i data-feather="pause"></i>
                </button>
                <div id="timer" class="game-timer">00:00:00</div>
            </div>
        </header>

        <div class="game-board-container">
            <div id="sudoku-board"></div>
            
            <div class="game-controls">
                <div class="control-buttons">
                    <button class="icon-btn" id="undo">
                        <i data-feather="rotate-ccw"></i>
                    </button>
                    <button class="icon-btn" id="redo">
                        <i data-feather="rotate-cw"></i>
                    </button>
                    <button class="icon-btn" id="hint">
                        <i data-feather="help-circle"></i>
                    </button>
                    <button class="icon-btn" id="pencil">
                        <i data-feather="edit"></i>
                    </button>
                </div>
                
                <div id="numpad" class="numpad-grid"></div>
            </div>
        </div>

        <section class="how-to-play">
            <h2>How to Play Sudoku</h2>
            <p>Fill in the empty cells with numbers from 1 to 9. Each number must appear exactly once in each row, column, and 3x3 box.</p>
        </section>

        <div class="mobile-download">
            <h3>Play Sudoku on Mobile</h3>
            <div class="app-buttons">
                <a href="#" class="app-button">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/3/3c/Download_on_the_App_Store_Badge.svg" alt="Download on App Store">
                </a>
                <a href="#" class="app-button">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/7/78/Google_Play_Store_badge_EN.svg" alt="Get it on Google Play">
                </a>
            </div>
            <div class="qr-code">
                <img src="data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='100' height='100' fill='%23ffffff'/%3E%3C/svg%3E" alt="QR Code">
            </div>
        </div>
    </div>

    <!-- Scripts loaded at the bottom for better performance -->
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script src="{{ url_for('static', filename='js/timer.js') }}"></script>
    <script src="{{ url_for('static', filename='js/sudoku.js') }}"></script>
    <script src="{{ url_for('static', filename='js/game.js') }}"></script>
    <script>
        // Initialize everything after DOM is fully loaded
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM fully loaded, initializing game...');
            
            // Initialize Feather icons
            try {
                feather.replace();
                console.log('Feather icons initialized successfully');
            } catch (error) {
                console.error('Failed to initialize Feather icons:', error);
            }
            
            // Initialize game after ensuring all elements are loaded
            try {
                // Verify required elements exist before initialization
                const requiredElements = [
                    'sudoku-board',
                    'numpad',
                    'timer',
                    'pause'
                ];
                
                const missingElements = requiredElements.filter(id => !document.getElementById(id));
                if (missingElements.length > 0) {
                    throw new Error(`Missing required elements: ${missingElements.join(', ')}`);
                }
                
                window.game = new SudokuGame();
                console.log('Game initialized successfully');
            } catch (error) {
                console.error('Failed to initialize game:', error);
                // Show user-friendly error message
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error-message';
                errorDiv.textContent = 'Failed to load the game. Please refresh the page.';
                const container = document.querySelector('.game-container');
                if (container) {
                    container.prepend(errorDiv);
                }
            }
        });
    </script>
</body>
</html>
